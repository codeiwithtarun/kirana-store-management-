<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kirana Store Management</title>
    
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: #fff;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        h1 {
            text-align: center;
            color: #333;
        }

        h2 {
            text-align: center;
            color: #555; /* Slightly lighter color for the name */
            margin-bottom: 10px; /* Space between name and title */
            font-size: 28px; /* Increased font size for the name */
        }

        #customerForm {
            display: flex;
            flex-wrap: wrap; /* Allow wrapping of input fields */
            gap: 10px;
            margin-bottom: 20px;
        }

        #customerForm input, #customerForm button {
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        /* Specific styles for price input */
        #price {
            width: 80px; /* Set a fixed width for price */
        }

        #customerName, #productName {
            flex: 1; /* Allow these fields to take up remaining space */
        }

        /* Styles for quantity and date inputs */
        #quantity {
            flex: 1; /* Allow quantity input to take up remaining space */
            width: auto; /* Allow width to adjust */
        }
        #transactionDate {
            flex: none;
            width: 150px;
        }

        #customerForm button {
            background-color: #5cb85c;
            color: white;
            border: none;
            cursor: pointer;
            flex: none;
        }

        #customerForm button:hover {
            background-color: #4cae4c;
        }

        #searchContainer {
            margin-bottom: 20px;
        }

        #searchInput {
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            width: 100%;
        }

        #customerTable {
            width: 100%;
            border-collapse: collapse;
        }

        #customerTable th, #customerTable td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
            vertical-align: top;
        }
        #customerTable td:nth-child(4) {
            white-space: nowrap;
        }

        #customerTable th {
            background-color: #f2f2f2;
        }

        .actions button {
            padding: 5px 10px;
            margin-right: 5px;
            border: none;
            cursor: pointer;
            border-radius: 3px;
        }

        .edit-btn {
            background-color: #337ab7;
            color: white;
        }

        .delete-btn {
            background-color: #d9534f;
            color: white;
        }
        .highlight {
            background-color: #ffff99;
            font-weight: bold;
        }

        /* Styles for the summary display */
        #summary {
            margin-top: 20px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            background-color: #e9f7ef;
        }

        #summary h3 {
            margin: 0 0 10px;
        }

        #summary p {
            margin: 5px 0;
        }
    </style>
</head>
<body>

    <div class="container">
        <h2>Amit Tyagi</h2> <!-- Name with increased font size -->
        <h1>Kirana Store Customer Management</h1>

        <div id="searchContainer">
            <input type="text" id="searchInput" placeholder="Search Customer Name">
        </div>

        <form id="customerForm">
            <input type="hidden" id="customerId">
            <input type="text" id="customerName" placeholder="Customer Name" required>
            <input type="text" id="productName" placeholder="Product Name" required>
            <input type="number" id="price" placeholder="Price" required>
            <input type="text" id="quantity" placeholder="Quantity (number or with unit)" required>
            <input type="date" id="transactionDate" required> <!-- Date input -->
            <button type="submit">Add/Update Product</button>
        </form>

        <div id="summary" style="display: none;">
            <h3>Last Added/Updated Customer</h3>
            <p><strong>Customer Name:</strong> <span id="summaryCustomerName"></span></p>
            <p><strong>Product Name:</strong> <span id="summaryProductName"></span></p>
            <p><strong>Price:</strong> <span id="summaryPrice"></span></p>
            <p><strong>Quantity:</strong> <span id="summaryQuantity"></span></p>
            <p><strong>Date:</strong> <span id="summaryDate"></span></p>
        </div>

        <table id="customerTable">
            <thead>
                <tr>
                    <th>S.No</th>
                    <th>Date</th>
                    <th>Customer Name</th>
                    <th>Product Details</th>
                    <th>Price</th>
                    <th>Quantity</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const customerForm = document.getElementById('customerForm');
            const customerTableBody = document.getElementById('customerTable').querySelector('tbody');
            const productIdInput = document.getElementById('customerId');
            const customerNameInput = document.getElementById('customerName');
            const productNameInput = document.getElementById('productName');
            const priceInput = document.getElementById('price');
            const quantityInput = document.getElementById('quantity');
            const transactionDateInput = document.getElementById('transactionDate');
            const searchInput = document.getElementById('searchInput');
            const summary = document.getElementById('summary');
            const summaryCustomerName = document.getElementById('summaryCustomerName');
            const summaryProductName = document.getElementById('summaryProductName');
            const summaryPrice = document.getElementById('summaryPrice');
            const summaryQuantity = document.getElementById('summaryQuantity');
            const summaryDate = document.getElementById('summaryDate');

            // Load customers from local storage
            let customers = JSON.parse(localStorage.getItem('customers')) || [];

            // Render the customer table
            function renderTable(filteredCustomers) {
                customerTableBody.innerHTML = '';
                const dataToRender = filteredCustomers || customers;
                dataToRender.forEach((customer, index) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${index + 1}</td>
                        <td>${customer.transactionDate}</td>
                        <td>${customer.customerName}</td>
                        <td>
                            <strong>${customer.productName}</strong>
                        </td>
                        <td>${customer.price}</td>
                        <td>${customer.quantity}</td>
                        <td class="actions">
                            <button class="edit-btn" onclick="editCustomer(${index})">Edit</button>
                            <button class="delete-btn" onclick="deleteCustomer(${index})">Delete</button>
                        </td>
                    `;
                    customerTableBody.appendChild(row);
                });
            }

            // Filter customers based on search input
            function filterCustomers() {
                const searchTerm = searchInput.value.toLowerCase();
                const filteredCustomers = searchTerm 
                    ? customers.filter(c => c.customerName.toLowerCase().includes(searchTerm))
                    : customers;
                
                renderTable(filteredCustomers);
                
                // Highlight matches
                document.querySelectorAll('#customerTable tbody tr').forEach(row => {
                    const nameCell = row.querySelector('td:nth-child(3)');
                    const matches = nameCell && searchTerm && 
                        nameCell.textContent.toLowerCase().includes(searchTerm);
                    row.classList.toggle('highlight', matches);
                });
            }

            // Handle form submission
            customerForm.addEventListener('submit', (e) => {
                e.preventDefault();

                const price = parseFloat(priceInput.value);
                const quantity = quantityInput.value.trim();
                const transactionDate = transactionDateInput.value; // Capture the date

                if (price <= 0 || quantity === '' || !/^[a-zA-Z0-9\s]+$/.test(quantity)) {
                    alert('Price must be positive. Quantity can be numbers only or with any text (e.g. 5, half kg, 1 dozen)');
                    return;
                }

                const customer = {
                    customerName: customerNameInput.value,
                    productName: productNameInput.value,
                    price: price,
                    quantity: quantity,
                    transactionDate: transactionDate // Include the date in the customer object
                };

                const editId = productIdInput.value;
                if (editId === '') {
                    customers.push(customer);
                    alert('Product added successfully!');
                } else {
                    customers[editId] = customer;
                    alert('Product updated successfully!');
                }

                // Debugging: Log the customers array before saving
                console.log('Saving customers:', customers);
                localStorage.setItem('customers', JSON.stringify(customers));
                
                // Debugging: Check if data is saved
                console.log('Local Storage:', localStorage.getItem('customers'));

                customerForm.reset();
                productIdInput.value = '';

                // Update summary display
                summaryCustomerName.textContent = customer.customerName;
                summaryProductName.textContent = customer.productName;
                summaryPrice.textContent = customer.price;
                summaryQuantity.textContent = customer.quantity;
                summaryDate.textContent = customer.transactionDate;
                summary.style.display = 'block'; // Show the summary

                renderTable();
            });

            // Edit customer function
            window.editCustomer = (index) => {
                const customer = customers[index];
                productIdInput.value = index;
                customerNameInput.value = customer.customerName;
                productNameInput.value = customer.productName;
                priceInput.value = customer.price;
                quantityInput.value = customer.quantity; // Set the quantity
                transactionDateInput.value = customer.transactionDate; // Set the date
            };

            // Delete customer function
            window.deleteCustomer = (index) => {
                if (confirm('Are you sure you want to delete this entry?')) {
                    customers.splice(index, 1);
                    localStorage.setItem('customers', JSON.stringify(customers));
                    renderTable();
                    alert('Product deleted successfully!');
                }
            };

            // Initial render of the table
            renderTable();
        });
    </script>
</body>
</html>
